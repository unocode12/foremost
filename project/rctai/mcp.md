# MCP (Model Context Protocol) ê¸°ìˆ  ë¶„ì„

## ğŸ“‹ ëª©ì°¨

1. [MCP ê°œìš”](#1-mcp-ê°œìš”)
2. [ì „ì²´ ì‹¤í–‰ íë¦„](#2-ì „ì²´-ì‹¤í–‰-íë¦„)
3. [ë„êµ¬ ëª©ë¡ ì¡°íšŒ íë¦„](#3-ë„êµ¬-ëª©ë¡-ì¡°íšŒ-íë¦„)
4. [ë„êµ¬ í˜¸ì¶œ ì‹¤í–‰ íë¦„](#4-ë„êµ¬-í˜¸ì¶œ-ì‹¤í–‰-íë¦„)
5. [ì•„í‚¤í…ì²˜ êµ¬ì¡°](#5-ì•„í‚¤í…ì²˜-êµ¬ì¡°)
6. [í•µì‹¬ ì»´í¬ë„ŒíŠ¸](#6-í•µì‹¬-ì»´í¬ë„ŒíŠ¸)
7. [í†µì‹  í”„ë¡œí† ì½œ](#7-í†µì‹ -í”„ë¡œí† ì½œ)
8. [í´ë¼ì´ì–¸íŠ¸ êµ¬í˜„](#8-í´ë¼ì´ì–¸íŠ¸-êµ¬í˜„)
9. [ë‚´ë¶€ MCP ì„œë²„](#9-ë‚´ë¶€-mcp-ì„œë²„)

---

## 1. MCP ê°œìš”

### 1.1 MCPë€?

**Model Context Protocol (MCP)**ì€ LLM(Large Language Model)ì´ ì™¸ë¶€ ì• í”Œë¦¬ì¼€ì´ì…˜, ë°ì´í„° ì†ŒìŠ¤, ë„êµ¬ì™€ í†µì‹ í•˜ê¸° ìœ„í•œ **í‘œì¤€í™”ëœ ê°œë°©í˜• í”„ë¡œí† ì½œ**ì…ë‹ˆë‹¤.

**í•µì‹¬ ê°œë…:**
- LLMì´ ì •ë³´ë¥¼ ì–»ê³  ì‘ì—…ì„ ì‹¤í–‰í•˜ê¸° ìœ„í•œ ë²”ìš© ì—°ê²° ë°©ë²•
- í´ë¼ì´ì–¸íŠ¸-ì„œë²„ ì•„í‚¤í…ì²˜ ê¸°ë°˜
- JSON-RPC 2.0 í”„ë¡œí† ì½œ ì‚¬ìš©
- Tool Discovery, Resource Access, Prompt Templates ì§€ì›

### 1.2 í”„ë¡œì íŠ¸ì—ì„œì˜ ì—­í• 

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LLM (OpenAI, Claude ë“±)                â”‚
â”‚  â””â”€ Tool í˜¸ì¶œ ìš”ì²­                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Agent (Orchestrator/Executor)          â”‚
â”‚  â””â”€ MCP Tool ëª©ë¡ ì œê³µ                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  McpClientManager                       â”‚
â”‚  â””â”€ Tool íƒ€ì…ë³„ ë¼ìš°íŒ…                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â†“                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ë‚´ë¶€ MCPâ”‚      â”‚ ì™¸ë¶€ MCP ì„œë²„â”‚
â”‚ ì„œë²„    â”‚      â”‚ (HTTP+SSE)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ì „ì²´ ì‹¤í–‰ íë¦„

### 2.1 Orchestrator Agent ì‹¤í–‰ íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ì‚¬ìš©ì ìš”ì²­                                                  â”‚
â”‚    "íšŒì‚¬ ì¶œì¥ê·œì •ì„ ì¡°íšŒí•´ì¤˜"                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. OrchestratorAgentMcpExecutor.execute()                       â”‚
â”‚    - ì‚¬ìš©ì ìš”ì²­ ìˆ˜ì‹                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. ë„êµ¬ ëª©ë¡ ì¡°íšŒ                                                â”‚
â”‚    tools = await mcp_client_manager.get_available_tools()       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. LLMì—ê²Œ ë„êµ¬ ëª©ë¡ ì œê³µ                                        â”‚
â”‚    - ë„êµ¬ ì´ë¦„, ì„¤ëª…, íŒŒë¼ë¯¸í„° ì •ë³´                              â”‚
â”‚    - ì˜ˆ: "123://get_business_trip_regulations: ì¶œì¥ê·œì • ì¡°íšŒ..." â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. LLMì´ ì‘ì—… ê³„íš ìˆ˜ë¦½                                          â”‚
â”‚    - ì‚¬ìš© ê°€ëŠ¥í•œ ë„êµ¬ ë¶„ì„                                        â”‚
â”‚    - ì‘ì—… ë‹¨ê³„ë³„ ê³„íš ìƒì„±                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. ê° ì‘ì—… ë‹¨ê³„ë³„ ì‹¤í–‰                                            â”‚
â”‚    for task in task_plan_list:                                  â”‚
â”‚        result = await mcp_client_manager.call_tool(...)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. ê²°ê³¼ ìˆ˜ì§‘ ë° ìµœì¢… ì‘ë‹µ ìƒì„±                                    â”‚
â”‚    - ê° ë‹¨ê³„ ê²°ê³¼ ìˆ˜ì§‘                                            â”‚
â”‚    - LLMì´ ìµœì¢… ìš”ì•½ ìƒì„±                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨

```
ì‚¬ìš©ì    Orchestrator    McpClientManager    MCP Client    MCP Server
  â”‚            â”‚                 â”‚                â”‚             â”‚
  â”‚â”€â”€ìš”ì²­â”€â”€â”€â”€â”€>â”‚                 â”‚                â”‚             â”‚
  â”‚            â”‚                 â”‚                â”‚             â”‚
  â”‚            â”‚â”€â”€ë„êµ¬ ëª©ë¡ ìš”ì²­â”€>â”‚                â”‚             â”‚
  â”‚            â”‚                 â”‚                â”‚             â”‚
  â”‚            â”‚<â”€â”€ë„êµ¬ ëª©ë¡ ë°˜í™˜â”€â”‚                â”‚             â”‚
  â”‚            â”‚                 â”‚                â”‚             â”‚
  â”‚            â”‚â”€â”€LLM í˜¸ì¶œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚            â”‚                 â”‚                â”‚             â”‚
  â”‚            â”‚<â”€ì‘ì—… ê³„íšâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚            â”‚                 â”‚                â”‚             â”‚
  â”‚            â”‚â”€â”€ë„êµ¬ í˜¸ì¶œâ”€â”€â”€â”€â”€â”€>â”‚                â”‚             â”‚
  â”‚            â”‚                 â”‚                â”‚             â”‚
  â”‚            â”‚                 â”‚â”€â”€MCP ìš”ì²­â”€â”€â”€â”€â”€â”€â”€>â”‚             â”‚
  â”‚            â”‚                 â”‚                â”‚             â”‚
  â”‚            â”‚                 â”‚                â”‚â”€â”€ë„êµ¬ ì‹¤í–‰â”€â”€>â”‚
  â”‚            â”‚                 â”‚                â”‚             â”‚
  â”‚            â”‚                 â”‚                â”‚<â”€ê²°ê³¼ ë°˜í™˜â”€â”€â”€â”‚
  â”‚            â”‚                 â”‚                â”‚             â”‚
  â”‚            â”‚                 â”‚<â”€MCP ì‘ë‹µâ”€â”€â”€â”€â”€â”€â”‚             â”‚
  â”‚            â”‚                 â”‚                â”‚             â”‚
  â”‚            â”‚<â”€â”€ë„êµ¬ ê²°ê³¼â”€â”€â”€â”€â”€â”€â”‚                â”‚             â”‚
  â”‚            â”‚                 â”‚                â”‚             â”‚
  â”‚            â”‚â”€â”€ìµœì¢… ì‘ë‹µ ìƒì„±â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚            â”‚                 â”‚                â”‚             â”‚
  â”‚<â”€ìµœì¢… ì‘ë‹µâ”€â”‚                 â”‚                â”‚             â”‚
```

---

## 3. ë„êµ¬ ëª©ë¡ ì¡°íšŒ íë¦„

### 3.1 ìƒì„¸ íë¦„ë„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OrchestratorAgentMcpExecutor.execute()                      â”‚
â”‚   agent_instance_id = input.agent_instance_id               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ mcp_client_manager.get_available_tools(agent_instance_id)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. DBì—ì„œ ë„êµ¬ ì„¤ì • ì¡°íšŒ                                       â”‚
â”‚    tool_settings = await mcp_repository                      â”‚
â”‚        .get_tool_settings_by_agent_instance_id(...)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. ê° ë„êµ¬ ì„¤ì •ë³„ ì •ë³´ ìˆ˜ì§‘                                    â”‚
â”‚    for tool_setting in tool_settings:                        â”‚
â”‚        if tool_type == MCP:                                  â”‚
â”‚            - MCP ì„œë²„ ì •ë³´ ì¡°íšŒ                               â”‚
â”‚            - ì‹¤ì œ ë„êµ¬ ì´ë¦„, input_schema ìˆ˜ì§‘                â”‚
â”‚        elif tool_type == SERVICE:                            â”‚
â”‚            - ì„œë¹„ìŠ¤ ID ì €ì¥                                   â”‚
â”‚        elif tool_type == AGENT:                               â”‚
â”‚            - ì—ì´ì „íŠ¸ ì •ë³´ ìˆ˜ì§‘                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. LLMìš© ë„êµ¬ ì„¤ëª… ìƒì„±                                        â”‚
â”‚    for tool_data in tool_data_list:                          â”‚
â”‚        tool_description = _build_tool_description(tool_data)  â”‚
â”‚        - tool_name: "123://get_business_trip_regulations"    â”‚
â”‚        - description: "ì¶œì¥ê·œì • ì¡°íšŒ [ì‚¬ì „ì„¤ì • íŒŒë¼ë¯¸í„°: ...]"â”‚
â”‚        - parameters_info: "bizNo (string) [í•„ìˆ˜] - ..."      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. ë„êµ¬ ì„¤ëª… ë¦¬ìŠ¤íŠ¸ ë°˜í™˜                                        â”‚
â”‚    return tool_descriptions                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. LLMì—ê²Œ ë„êµ¬ ëª©ë¡ ì œê³µ                                      â”‚
â”‚    tool_descriptionsë¥¼ í”„ë¡¬í”„íŠ¸ì— í¬í•¨                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 ë„êµ¬ ì„¤ëª… ìƒì„± ì˜ˆì‹œ

**ì…ë ¥ ë°ì´í„°:**
```python
tool_data = {
    "name": "get_business_trip_regulations",
    "description": "íšŒì‚¬ë³„ ì¶œì¥ê·œì • ë¬¸ì„œë¥¼ ì¡°íšŒ",
    "tool_type": "MCP",
    "server_id": 123,
    "input_schema": {
        "properties": {
            "bizNo": {
                "type": "string",
                "description": "ì‚¬ì—…ìë²ˆí˜¸ (7ìë¦¬)"
            }
        },
        "required": ["bizNo"]
    },
    "preset_parameters": {}
}
```

**ìƒì„±ëœ ë„êµ¬ ì„¤ëª…:**
```python
{
    "tool_name": "123://get_business_trip_regulations",
    "description": "íšŒì‚¬ë³„ ì¶œì¥ê·œì • ë¬¸ì„œë¥¼ ì¡°íšŒ [ëª¨ë“  íŒŒë¼ë¯¸í„°ë¥¼ LLMì´ ì§ì ‘ ì œê³µí•´ì•¼ í•©ë‹ˆë‹¤.]",
    "parameters_info": "bizNo (string) [í•„ìˆ˜, LLMì´ ì œê³µí•´ì•¼ í•¨] - ì‚¬ì—…ìë²ˆí˜¸ (7ìë¦¬)"
}
```

**LLMì—ê²Œ ì „ë‹¬ë˜ëŠ” í˜•ì‹:**
```
  - 123://get_business_trip_regulations: íšŒì‚¬ë³„ ì¶œì¥ê·œì • ë¬¸ì„œë¥¼ ì¡°íšŒ [ëª¨ë“  íŒŒë¼ë¯¸í„°ë¥¼ LLMì´ ì§ì ‘ ì œê³µí•´ì•¼ í•©ë‹ˆë‹¤.]
    ë§¤ê°œë³€ìˆ˜: bizNo (string) [í•„ìˆ˜, LLMì´ ì œê³µí•´ì•¼ í•¨] - ì‚¬ì—…ìë²ˆí˜¸ (7ìë¦¬)
```

---

## 4. ë„êµ¬ í˜¸ì¶œ ì‹¤í–‰ íë¦„

### 4.1 ì „ì²´ í˜¸ì¶œ íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LLMì´ ë„êµ¬ í˜¸ì¶œ ìš”ì²­                                          â”‚
â”‚ tool_name = "123://get_business_trip_regulations"           â”‚
â”‚ arguments = {"bizNo": "1234567"}                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ mcp_client_manager.call_tool(tool_name, args, agent_id)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. tool_name íŒŒì‹±                                             â”‚
â”‚    if "://" in tool_name:                                    â”‚
â”‚        server_id, tool_name = tool_name.split("://")         â”‚
â”‚    # server_id = "123", tool_name = "get_business_trip..."   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. ë„êµ¬ ì»¨í…ìŠ¤íŠ¸ ì¡°íšŒ                                          â”‚
â”‚    tool_context = await _get_tool_context(...)               â”‚
â”‚    - DBì—ì„œ tool_setting ì¡°íšŒ                                 â”‚
â”‚    - tool_type, server_id, actual_tool_name ë“± ìˆ˜ì§‘           â”‚
â”‚    - preset_parametersì™€ args ë³‘í•©                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. ë„êµ¬ íƒ€ì…ë³„ ë¼ìš°íŒ…                                          â”‚
â”‚    if tool_type == ToolType.MCP:                             â”‚
â”‚        â†’ _execute_mcp_tool()                                 â”‚
â”‚    elif tool_type == ToolType.SERVICE:                       â”‚
â”‚        â†’ _execute_service_tool()                             â”‚
â”‚    elif tool_type == ToolType.AGENT:                         â”‚
â”‚        â†’ _execute_agent_tool()                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 MCP íƒ€ì… ë„êµ¬ ì‹¤í–‰ íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ _execute_mcp_tool(tool_context, server_id, arguments)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ë‚´ë¶€/ì™¸ë¶€ ì„œë²„ íŒë‹¨                                         â”‚
â”‚    internal_server_id = await _get_internal_server_id()      â”‚
â”‚    if server_id == internal_server_id:                      â”‚
â”‚        â†’ ë‚´ë¶€ MCP ì„œë²„ í˜¸ì¶œ                                    â”‚
â”‚    else:                                                     â”‚
â”‚        â†’ ì™¸ë¶€ MCP ì„œë²„ í˜¸ì¶œ                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“                                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ë‚´ë¶€ MCP ì„œë²„ í˜¸ì¶œ     â”‚              â”‚ ì™¸ë¶€ MCP ì„œë²„ í˜¸ì¶œ     â”‚
â”‚                       â”‚              â”‚                       â”‚
â”‚ from mcp import mcp   â”‚              â”‚ client = await        â”‚
â”‚ result = await mcp    â”‚              â”‚     _create_client()   â”‚
â”‚     .call_tool(...)   â”‚              â”‚                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚ result = await client  â”‚
        â”‚                              â”‚     .call_tool(...)   â”‚
        â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                                        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ ê²°ê³¼ ë°˜í™˜                               â”‚
        â”‚ return {"result": str(result)}        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 ì™¸ë¶€ MCP ì„œë²„ í˜¸ì¶œ ìƒì„¸ íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ _create_client(tool_context)                                 â”‚
â”‚   - ì„œë²„ IDë¡œ í´ë¼ì´ì–¸íŠ¸ ìºì‹œ í™•ì¸                            â”‚
â”‚   - ìºì‹œ ì—†ìœ¼ë©´ ìƒˆ í´ë¼ì´ì–¸íŠ¸ ìƒì„±                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ client.call_tool(actual_tool_name, arguments)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ì„œë²„ ì—°ê²° í™•ì¸                                              â”‚
â”‚    if not await self.connect():                              â”‚
â”‚        - initialize ìš”ì²­ ì „ì†¡                                 â”‚
â”‚        - ì—°ê²° ìƒíƒœ í™•ì¸                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. MCP ìš”ì²­ ì „ì†¡                                               â”‚
â”‚    _send_mcp_request("tools/call", {                         â”‚
â”‚        "name": actual_tool_name,                              â”‚
â”‚        "arguments": arguments                                 â”‚
â”‚    })                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. JSON-RPC ë©”ì‹œì§€ ìƒì„±                                       â”‚
â”‚    message = {                                                â”‚
â”‚        "jsonrpc": "2.0",                                      â”‚
â”‚        "id": "uuid",                                          â”‚
â”‚        "method": "tools/call",                                â”‚
â”‚        "params": {...}                                        â”‚
â”‚    }                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. HTTP ìš”ì²­ ì „ì†¡ (HttpSseMcpClient)                           â”‚
â”‚    POST /endpoint                                             â”‚
â”‚    Headers: Content-Type, Accept: text/event-stream         â”‚
â”‚    Body: JSON-RPC message                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. SSE ìŠ¤íŠ¸ë¦¼ ì‘ë‹µ ìˆ˜ì‹                                         â”‚
â”‚    async for line in response.aiter_lines():                 â”‚
â”‚        if line.startswith("data: "):                         â”‚
â”‚            response_data = json.loads(data_str)               â”‚
â”‚            if response_data["id"] == request_id:             â”‚
â”‚                return response_data["result"]                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. ê²°ê³¼ ë°˜í™˜                                                   â”‚
â”‚    return {"result": str(result)}                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.4 SERVICE íƒ€ì… ë„êµ¬ ì‹¤í–‰ íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ _execute_service_tool(tool_context, arguments)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ì„œë¹„ìŠ¤ ID ì¶”ì¶œ                                              â”‚
â”‚    service_id = tool_context["tool_reference_id"]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° ì¤€ë¹„                                          â”‚
â”‚    query = arguments.get("query", "")                         â”‚
â”‚    if not query:                                             â”‚
â”‚        query = str(arguments)                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. ì›Œí¬í”Œë¡œìš° ì‹¤í–‰                                             â”‚
â”‚    execution_input = ExecutionInput(query=query)              â”‚
â”‚    result = await workflow_engine.execute_service(            â”‚
â”‚        service_id=service_id,                                â”‚
â”‚        execution_input=execution_input,                       â”‚
â”‚        input_data=arguments                                  â”‚
â”‚    )                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. ê²°ê³¼ ë°˜í™˜                                                   â”‚
â”‚    return {"result": str(result)}                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.5 AGENT íƒ€ì… ë„êµ¬ ì‹¤í–‰ íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ _execute_agent_tool(tool_context, arguments, agent_id)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ì—ì´ì „íŠ¸ ë ˆì§€ìŠ¤íŠ¸ë¦¬ì—ì„œ ì¡°íšŒ                                â”‚
â”‚    agent_registry = get_agent_registry()                     â”‚
â”‚    agent_sub_type = tool_context["agent_sub_type"]           â”‚
â”‚    agent = agent_registry.get_agent(agent_sub_type)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. ì—ì´ì „íŠ¸ ì¸ìŠ¤í„´ìŠ¤ ì •ë³´ êµ¬ì„±                                  â”‚
â”‚    agent_instance_info = {                                    â”‚
â”‚        "agent_instance_id": agent_instance_id,               â”‚
â”‚        "agent_id": tool_context["agent_id"],                 â”‚
â”‚        "agent_type": tool_context["agent_type"],              â”‚
â”‚        "agent_sub_type": agent_sub_type,                     â”‚
â”‚        "common_parameters": preset_parameters["common"],      â”‚
â”‚        "custom_parameters": preset_parameters["custom"]       â”‚
â”‚    }                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. ì—ì´ì „íŠ¸ ì‹¤í–‰                                               â”‚
â”‚    result = await agent.invoke(                               â”‚
â”‚        agent_instance_info=agent_instance_info,               â”‚
â”‚        user_input=arguments,                                 â”‚
â”‚        prev_results=None                                      â”‚
â”‚    )                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. ê²°ê³¼ ë°˜í™˜                                                   â”‚
â”‚    return {"result": str(result)}                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. Orchestrator Agentë¥¼ í†µí•œ í˜¸ì¶œ

### 5.1 Orchestrator Agentì˜ ì—­í• 

**Orchestrator Agent**ëŠ” LLMì„ í™œìš©í•˜ì—¬ ì‘ì—… ê³„íšì„ ìˆ˜ë¦½í•˜ê³ , ì—¬ëŸ¬ ë„êµ¬ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰í•˜ëŠ” ì—ì´ì „íŠ¸ì…ë‹ˆë‹¤.

**íŠ¹ì§•:**
- LLMì´ ì‘ì—… ê³„íš ìˆ˜ë¦½
- ì—¬ëŸ¬ ë„êµ¬ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰
- ì´ì „ ì‘ì—… ê²°ê³¼ë¥¼ ë‹¤ìŒ ì‘ì—…ì— ì „ë‹¬
- ìµœì¢… ê²°ê³¼ ìš”ì•½ ìƒì„±

### 5.2 ì‹¤í–‰ íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. OrchestratorAgentMcpExecutor.execute()                   â”‚
â”‚    - ì‚¬ìš©ì ìš”ì²­ ìˆ˜ì‹                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. ë„êµ¬ ëª©ë¡ ì¡°íšŒ                                              â”‚
â”‚    tools = await mcp_client_manager.get_available_tools()    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. LLMì—ê²Œ ì‘ì—… ê³„íš ìˆ˜ë¦½ ìš”ì²­                                  â”‚
â”‚    - ë„êµ¬ ëª©ë¡ê³¼ ì‚¬ìš©ì ìš”ì²­ì„ LLMì— ì „ë‹¬                       â”‚
â”‚    - LLMì´ ì‘ì—… ë‹¨ê³„ë³„ ê³„íš ìƒì„±                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. ì‘ì—… ê³„íš íŒŒì‹±                                               â”‚
â”‚    task_plan_list = await _parse_task_plan_from_llm_response()â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. ê° ì‘ì—… ë‹¨ê³„ë³„ ì‹¤í–‰                                          â”‚
â”‚    for task in task_plan_list:                                â”‚
â”‚        - ì´ì „ ì‘ì—… ê²°ê³¼ ì°¸ì¡° ì²˜ë¦¬                               â”‚
â”‚        - mcp_client_manager.call_tool() í˜¸ì¶œ                  â”‚
â”‚        - ê²°ê³¼ ìˆ˜ì§‘                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. ìµœì¢… ìš”ì•½ ìƒì„±                                               â”‚
â”‚    result = await _call_task_plan_summary_llm()               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.3 ì½”ë“œ ì˜ˆì‹œ

```python
class OrchestratorAgentMcpExecutor(OrchestratorAgent):
    async def execute(self, input: OrchestratorAgentMcpExecutorIn):
        # 1. ë„êµ¬ ëª©ë¡ ì¡°íšŒ
        tools_from_manager = await mcp_client_manager.get_available_tools(agent_instance_id)
        
        # 2. LLMìš© ë„êµ¬ ì„¤ëª… ìƒì„±
        tool_descriptions = self._build_tool_descriptions(tools_from_manager)
        
        # 3. LLMì—ê²Œ ì‘ì—… ê³„íš ìˆ˜ë¦½ ìš”ì²­
        initial_task_plan_llm_result = await self._call_task_plan_creator_llm(
            query,
            task_plan_message_id,
            tool_descriptions,
            previous_task_results=task_results,
        )
        
        # 4. ì‘ì—… ê³„íš íŒŒì‹±
        task_plan_list = await self._parse_task_plan_from_llm_response(
            initial_task_plan_llm_result.llm_response
        )
        
        # 5. ê° ì‘ì—… ë‹¨ê³„ë³„ ì‹¤í–‰
        for task in task_plan_list:
            tool_name = task["tool_name"]
            parameters = task["parameters"]
            
            # ì´ì „ ì‘ì—… ê²°ê³¼ ì°¸ì¡° ì²˜ë¦¬
            processed_parameters = {}
            for key, value in parameters.items():
                if isinstance(value, str) and value.startswith("result_of_task_"):
                    processed_parameters[key] = prev_task_result
                else:
                    processed_parameters[key] = value
            
            # ë„êµ¬ í˜¸ì¶œ
            result = await mcp_client_manager.call_tool(
                tool_name, 
                processed_parameters, 
                agent_instance_id
            )
            
            task_results.append({**task, "task_result": str(result)})
            prev_task_result = str(result)
        
        # 6. ìµœì¢… ìš”ì•½ ìƒì„±
        result = await self._call_task_plan_summary_llm(
            query, 
            tool_descriptions, 
            result_by_step=task_results
        )
        return OrchestratorAgentMcpExecutorOut.model_validate(result.model_dump())
```

---

## 6. Executor Agentë¥¼ í†µí•œ í˜¸ì¶œ

### 6.1 Executor Agentì˜ ì—­í• 

**Executor Agent**ëŠ” ì›Œí¬í”Œë¡œìš°ì—ì„œ ì§ì ‘ í˜¸ì¶œë˜ì–´ ë‹¨ì¼ ë„êµ¬ë¥¼ ì‹¤í–‰í•˜ëŠ” ì—ì´ì „íŠ¸ì…ë‹ˆë‹¤.

**íŠ¹ì§•:**
- ì›Œí¬í”Œë¡œìš° ë…¸ë“œì—ì„œ ì§ì ‘ í˜¸ì¶œ
- ë‹¨ì¼ ë„êµ¬ ì‹¤í–‰ì— íŠ¹í™”
- ì´ì „ ë…¸ë“œ ê²°ê³¼ë¥¼ ì…ë ¥ìœ¼ë¡œ ë°›ì„ ìˆ˜ ìˆìŒ
- ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ ì§€ì›

### 6.2 ì‹¤í–‰ íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ì›Œí¬í”Œë¡œìš° ë…¸ë“œì—ì„œ ExecutorAgentMcpTool í˜¸ì¶œ              â”‚
â”‚    - ì´ì „ ë…¸ë“œì˜ ê²°ê³¼ë¥¼ prev_resultë¡œ ì „ë‹¬                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. ExecutorAgentMcpTool.execute()                           â”‚
â”‚    - ì…ë ¥ íŒŒë¼ë¯¸í„° ì „ì²˜ë¦¬                                       â”‚
â”‚    - ë„êµ¬ ì´ë¦„, íŒŒë¼ë¯¸í„° ì¶”ì¶œ                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. ì´ì „ ê²°ê³¼ ì²˜ë¦¬                                              â”‚
â”‚    - prev_resultë¥¼ íŒŒë¼ë¯¸í„°ì— ë³‘í•©                             â”‚
â”‚    - ë¬¸ìì—´ íŒŒì‹± ë° JSON ë³€í™˜                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. MCP ë„êµ¬ í˜¸ì¶œ                                               â”‚
â”‚    result = await mcp_client_manager.call_tool(              â”‚
â”‚        tool_name,                                             â”‚
â”‚        tool_input_parameters,                                 â”‚
â”‚        agent_instance_id                                      â”‚
â”‚    )                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. ê²°ê³¼ ì²˜ë¦¬ ë° ìŠ¤íŠ¸ë¦¬ë°                                        â”‚
â”‚    - ê²°ê³¼ íŒŒì‹± (TextContent í˜•íƒœ ì²˜ë¦¬)                         â”‚
â”‚    - ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ ì „ì†¡ (ì˜µì…˜)                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.3 ì½”ë“œ ì˜ˆì‹œ

```python
class ExecutorAgentMcpTool(ExecutorAgent):
    agent_unique_name = "executor_agent_mcp_tool"
    
    async def execute(self, input: ExecutorAgentMcpToolIn):
        """MCP Tool ì‹¤í–‰ ë¡œì§"""
        # 1. ë„êµ¬ ì •ë³´ ì¶”ì¶œ
        tool_name = input.custom_parameters.parameters.get("name")
        tool_input_parameteres = input.custom_parameters.parameters.get("input_parameters")
        
        # 2. ì´ì „ ê²°ê³¼ ì²˜ë¦¬
        prev_result_data = input.custom_parameters.prev_result
        prev_result_value = {}
        
        if isinstance(prev_result_data, dict):
            prev_result_value = prev_result_data
        elif isinstance(prev_result_data, list) and len(prev_result_data) > 0:
            prev_result_value = prev_result_data[0]
        
        # 3. ì…ë ¥ íŒŒë¼ë¯¸í„° ë¬¸ìì—´ íŒŒì‹±
        tool_input_parameters_str = str(tool_input_parameteres)
        formatted_tool_input_parameters_str = auto_extract_and_format_instruction(
            tool_input_parameters_str, 
            prev_result_value  # ì´ì „ ê²°ê³¼ ë³‘í•©
        )
        
        # 4. JSON ë³€í™˜
        formatted_tool_input_parameters_str = formatted_tool_input_parameters_str.replace("'", '"')
        tool_input_parameters = json.loads(formatted_tool_input_parameters_str)
        
        # 5. MCP ë„êµ¬ í˜¸ì¶œ
        if input.agent_instance_id == -1:
            mcp_response = "Agent Builder ì—ì„œëŠ” ì‹¤í–‰í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
        else:
            result = await mcp_client_manager.call_tool(
                tool_name,
                tool_input_parameters,
                input.agent_instance_id,
            )
            result = result.get("result", None)
            
            # 6. ê²°ê³¼ íŒŒì‹± (TextContent í˜•íƒœ ì²˜ë¦¬)
            if result and isinstance(result, str):
                text_match = re.search(r"text='((?:[^'\\]|\\.)*)'", result)
                if text_match:
                    mcp_response = text_match.group(1)
        
        # 7. ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ ì²˜ë¦¬ (ì˜µì…˜)
        if input.common_parameters.is_response_required:
            message_id = str(ulid.ULID())
            if input.common_parameters.is_response_stream:
                await StreamManager.send_stream_message(
                    str(mcp_response),
                    message_id,
                    metadata={},
                    done=True,
                    appendable=False,
                )
        
        return ExecutorAgentMcpToolOut(result=str(mcp_response), mcp_response=mcp_response)
```

### 6.4 Orchestrator vs Executor ë¹„êµ

| í•­ëª© | Orchestrator Agent | Executor Agent |
|------|-------------------|----------------|
| **í˜¸ì¶œ ë°©ì‹** | ì‚¬ìš©ì ìš”ì²­ ì§ì ‘ ì²˜ë¦¬ | ì›Œí¬í”Œë¡œìš° ë…¸ë“œì—ì„œ í˜¸ì¶œ |
| **ì‘ì—… ë²”ìœ„** | ì—¬ëŸ¬ ë„êµ¬ ìˆœì°¨ ì‹¤í–‰ | ë‹¨ì¼ ë„êµ¬ ì‹¤í–‰ |
| **ê³„íš ìˆ˜ë¦½** | LLMì´ ì‘ì—… ê³„íš ìƒì„± | ì›Œí¬í”Œë¡œìš°ê°€ ì´ë¯¸ ì •ì˜ |
| **ê²°ê³¼ ì²˜ë¦¬** | ìµœì¢… ìš”ì•½ ìƒì„± | ë‹¨ìˆœ ê²°ê³¼ ë°˜í™˜ |
| **ì´ì „ ê²°ê³¼ í™œìš©** | `result_of_task_N` ì°¸ì¡° | `prev_result` ì§ì ‘ ì „ë‹¬ |
| **ìŠ¤íŠ¸ë¦¬ë°** | ì‘ì—… ë‹¨ê³„ë³„ ìŠ¤íŠ¸ë¦¬ë° | ì˜µì…˜ìœ¼ë¡œ ìŠ¤íŠ¸ë¦¬ë° ì§€ì› |

### 6.5 ì›Œí¬í”Œë¡œìš°ì—ì„œì˜ ì‚¬ìš© ì˜ˆì‹œ

```
ì›Œí¬í”Œë¡œìš° ë…¸ë“œ êµ¬ì„±:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Node 1:      â”‚
â”‚ LLM Agent   â”‚
â”‚ (SQL ìƒì„±)   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ prev_result
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Node 2:     â”‚
â”‚ Executor    â”‚
â”‚ Agent MCP   â”‚
â”‚ Tool        â”‚
â”‚ (DB ì¡°íšŒ)   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ prev_result
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Node 3:     â”‚
â”‚ LLM Agent   â”‚
â”‚ (ê²°ê³¼ ë¶„ì„)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Node 2 ì„¤ì •:**
```json
{
  "agent_sub_type": "executor_agent_mcp_tool",
  "custom_parameters": {
    "parameters": {
      "name": "rdb_query_tool",
      "input_parameters": {
        "query": "{{prev_result}}"
      }
    }
  }
}
```

---

## 7. ì•„í‚¤í…ì²˜ êµ¬ì¡°

### 7.1 ì „ì²´ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    McpClientManager                          â”‚
â”‚  - í´ë¼ì´ì–¸íŠ¸ ìºì‹± ë° ê´€ë¦¬                                   â”‚
â”‚  - ë„êµ¬ ëª©ë¡ ì¡°íšŒ                                            â”‚
â”‚  - ë„êµ¬ í˜¸ì¶œ ë¼ìš°íŒ…                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“                 â†“                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BaseMcpClientâ”‚  â”‚HttpSseMcp    â”‚  â”‚StreamableHttpâ”‚
â”‚ (ì¶”ìƒ í´ë˜ìŠ¤) â”‚  â”‚Client        â”‚  â”‚Client        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ë‚´ë¶€ MCP ì„œë²„ (FastMCP)                          â”‚
â”‚  - get_business_trip_regulations                             â”‚
â”‚  - get_corporate_rate_code                                  â”‚
â”‚  - ê¸°íƒ€ ë‚´ë¶€ ë„êµ¬ë“¤                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 ë„êµ¬ íƒ€ì… ë¶„ë¥˜

```python
# be_src/common/enums/mcp_enum.py
class ToolType:
    MCP = "mcp"           # ì™¸ë¶€ MCP ì„œë²„ ë„êµ¬
    SERVICE = "service"   # ë‚´ë¶€ ì„œë¹„ìŠ¤ ë„êµ¬
    AGENT = "agent"       # ë‚´ë¶€ ì—ì´ì „íŠ¸ ë„êµ¬
```

**ë„êµ¬ íƒ€ì…ë³„ íŠ¹ì§•:**

1. **MCP íƒ€ì…**
   - ì™¸ë¶€ MCP ì„œë²„ì—ì„œ ì œê³µí•˜ëŠ” ë„êµ¬
   - HTTP+SSE ë˜ëŠ” Streamable HTTPë¡œ í†µì‹ 
   - í‘œì¤€ MCP í”„ë¡œí† ì½œ ì¤€ìˆ˜

2. **SERVICE íƒ€ì…**
   - ë‚´ë¶€ ì›Œí¬í”Œë¡œìš° ì„œë¹„ìŠ¤ë¥¼ ë„êµ¬ë¡œ ë…¸ì¶œ
   - `workflow_engine.execute_service()` í˜¸ì¶œ
   - ì„œë¹„ìŠ¤ IDë¡œ ì‹¤í–‰

3. **AGENT íƒ€ì…**
   - ë‚´ë¶€ ì—ì´ì „íŠ¸ë¥¼ ë„êµ¬ë¡œ ë…¸ì¶œ
   - `AgentRegistry`ì—ì„œ ì—ì´ì „íŠ¸ ì¡°íšŒ í›„ ì‹¤í–‰
   - ì—ì´ì „íŠ¸ ì„œë¸Œ íƒ€ì…ìœ¼ë¡œ ì‹¤í–‰

---

## 8. í•µì‹¬ ì»´í¬ë„ŒíŠ¸

### 3.1 McpClientManager

**ì—­í• :** MCP í´ë¼ì´ì–¸íŠ¸ì˜ ì¤‘ì•™ ê´€ë¦¬ì

**ì£¼ìš” ê¸°ëŠ¥:**

```python
class McpClientManager:
    def __init__(self):
        self._internal_server_id = None
        self._client_cache: Dict[int, BaseMcpClient] = {}  # í´ë¼ì´ì–¸íŠ¸ ìºì‹±
        self._cache_lock = asyncio.Lock()  # ë™ì‹œì„± ì œì–´
```

#### 1. ë„êµ¬ ëª©ë¡ ì¡°íšŒ

```python
async def get_available_tools(self, agent_instance_id: int) -> List[Dict[str, Any]]:
    """
    ì—ì´ì „íŠ¸ ì¸ìŠ¤í„´ìŠ¤ì˜ ëª¨ë“  ì‚¬ìš© ê°€ëŠ¥í•œ ë„êµ¬ ëª©ë¡ ì¡°íšŒ
    """
    tool_settings = await mcp_repository.get_tool_settings_by_agent_instance_id(agent_instance_id)
    
    tool_data_list = []
    for tool_setting in tool_settings:
        # íƒ€ì…ë³„ ì •ë³´ ìˆ˜ì§‘
        if tool_setting.tool_type == ToolType.MCP:
            # MCP ì„œë²„ ì •ë³´ ì¶”ê°€
        elif tool_setting.tool_type == ToolType.SERVICE:
            # ë‚´ë¶€ ì„œë¹„ìŠ¤ ì •ë³´ ì¶”ê°€
        elif tool_setting.tool_type == ToolType.AGENT:
            # ë‚´ë¶€ ì—ì´ì „íŠ¸ ì •ë³´ ì¶”ê°€
    
    # LLMì´ ì´í•´í•  ìˆ˜ ìˆëŠ” í˜•íƒœë¡œ ë³€í™˜
    tool_descriptions = []
    for tool_data in tool_data_list:
        tool_description = self._build_tool_description(tool_data)
        tool_descriptions.append(tool_description)
    
    return tool_descriptions
```

**ë„êµ¬ ì´ë¦„ í˜•ì‹:**
```python
# ì„œë²„ IDì™€ ë„êµ¬ ì´ë¦„ì„ ê²°í•©
tool_name = f"{server_id}://{tool_data['name']}"
# ì˜ˆ: "123://get_business_trip_regulations"
```

#### 2. ë„êµ¬ í˜¸ì¶œ

```python
async def call_tool(
    self, 
    tool_name: str, 
    args: Dict[str, Any], 
    agent_instance_id: int
) -> Dict[str, Any]:
    """
    MCP ë„êµ¬ í˜¸ì¶œ (ê°„ì†Œí™”ëœ ì¸í„°í˜ì´ìŠ¤)
    """
    # tool_name íŒŒì‹±: "123://actual_tool" -> server_id, tool_name
    if "://" in tool_name:
        server_id, tool_name = tool_name.split("://")
    
    # ë„êµ¬ ì»¨í…ìŠ¤íŠ¸ ì¡°íšŒ
    tool_context = await self._get_tool_context(tool_name, agent_instance_id)
    
    # íƒ€ì…ë³„ ì‹¤í–‰
    if tool_type == ToolType.MCP:
        return await self._execute_mcp_tool(tool_context, server_id, args)
    elif tool_type == ToolType.SERVICE:
        return await self._execute_service_tool(tool_context, args)
    elif tool_type == ToolType.AGENT:
        return await self._execute_agent_tool(tool_context, args, agent_instance_id)
```

#### 3. í´ë¼ì´ì–¸íŠ¸ ìºì‹±

```python
async def _create_client(self, tool_context: Dict[str, Any]):
    """
    tool_contextë¡œë¶€í„° í´ë¼ì´ì–¸íŠ¸ ìƒì„± ë° ìºì‹±
    """
    server_id = tool_context["server_id"]
    
    async with self._cache_lock:  # ë™ì‹œì„± ì œì–´
        if server_id in self._client_cache:
            return self._client_cache[server_id]  # ìºì‹œëœ í´ë¼ì´ì–¸íŠ¸ ë°˜í™˜
        
        # ìƒˆ í´ë¼ì´ì–¸íŠ¸ ìƒì„±
        client = self._build_client_from_server_info(...)
        self._client_cache[server_id] = client
        return client
```

**ìºì‹± ì „ëµ:**
- ì„œë²„ IDë³„ë¡œ í´ë¼ì´ì–¸íŠ¸ ì¸ìŠ¤í„´ìŠ¤ ìºì‹±
- `asyncio.Lock()`ìœ¼ë¡œ ë™ì‹œì„± ì œì–´
- ì„œë²„ ì •ë³´ ë³€ê²½ ì‹œ `update_client()`ë¡œ ê°±ì‹ 

---

### 3.2 BaseMcpClient

**ì—­í• :** ëª¨ë“  MCP í´ë¼ì´ì–¸íŠ¸ì˜ ê¸°ë³¸ ì¶”ìƒ í´ë˜ìŠ¤

**ê³µí†µ ê¸°ëŠ¥:**

```python
class BaseMcpClient(ABC):
    @abstractmethod
    async def _send_mcp_request(self, method: str, params: Optional[Dict[str, Any]] = None) -> Any:
        """MCP ìš”ì²­ ì „ì†¡ - ê° í´ë¼ì´ì–¸íŠ¸ë³„ êµ¬í˜„"""
    
    @abstractmethod
    async def call_tool(self, tool_name: str, arguments: Dict[str, Any]) -> Dict[str, Any]:
        """MCP ë„êµ¬ í˜¸ì¶œ - ê° í´ë¼ì´ì–¸íŠ¸ë³„ êµ¬í˜„"""
    
    async def connect(self) -> bool:
        """MCP ì„œë²„ ì—°ê²° - ê³µí†µ ë¡œì§"""
        if self._initialized:
            return True
        
        params = self._create_initialize_params()
        await self._send_mcp_request("initialize", params)
        self._initialized = True
        return True
    
    async def list_tools(self) -> List[MCPTool]:
        """MCP ë„êµ¬ ëª©ë¡ ì¡°íšŒ - ê³µí†µ ë¡œì§"""
        if not await self.connect():
            return []
        
        result = await self._send_mcp_request("tools/list")
        tools = result.get("tools", [])
        return [MCPTool(**tool) for tool in tools]
```

**JSON-RPC 2.0 ë©”ì‹œì§€ ìƒì„±:**

```python
def _create_mcp_message(self, method: str, params: Optional[Dict[str, Any]] = None):
    """
    MCP í‘œì¤€ JSON-RPC 2.0 ë©”ì‹œì§€ ìƒì„±
    """
    request_id = str(uuid.uuid4())
    message = {
        "jsonrpc": "2.0",
        "id": request_id,
        "method": method,
    }
    
    if params is not None:
        message["params"] = params
    
    return message, request_id
```

**ì¸ì¦ í—¤ë” ìƒì„±:**

```python
def _get_auth_headers(self) -> Dict[str, str]:
    """
    ì¸ì¦ í—¤ë” ìƒì„± - ê³µí†µ ë¡œì§
    """
    headers = {}
    
    if self.auth_type == ExternalServerAuthType.API_KEY:
        headers["X-API-Key"] = self.auth_parameters["api-key"]
    # TODO: ë‹¤ë¥¸ ì¸ì¦ íƒ€ì… ì§€ì›
    
    return headers
```

---

### 3.3 HttpSseMcpClient vs StreamableHttpClient

ë‘ í´ë¼ì´ì–¸íŠ¸ëŠ” MCP ì„œë²„ì™€ í†µì‹ í•˜ëŠ” ë°©ì‹ì´ ë‹¤ë¦…ë‹ˆë‹¤. ì£¼ìš” ì°¨ì´ì ì„ ì •ë¦¬í•©ë‹ˆë‹¤.

#### 3.3.1 HttpSseMcpClient (HTTP+SSE ë°©ì‹)

**íŠ¹ì§•:**
- **í•­ìƒ SSE ìŠ¤íŠ¸ë¦¼ìœ¼ë¡œ ì‘ë‹µ ìˆ˜ì‹ **: POST ìš”ì²­ í›„ `client.stream()`ìœ¼ë¡œ ìŠ¤íŠ¸ë¦¼ ì‘ë‹µ ì²˜ë¦¬
- **í”„ë¡œí† ì½œ ë²„ì „**: `2024-11-05`
- **ì—”ë“œí¬ì¸íŠ¸ ì„¤ì •**: `McpServerConfig`ë¡œ ì»¤ìŠ¤í…€ ì—”ë“œí¬ì¸íŠ¸ ì§€ì›
- **Accept í—¤ë”**: `text/event-stream`ë§Œ ì§€ì •

**êµ¬í˜„:**

```python
class HttpSseMcpClient(BaseMcpClient):
    def __init__(self, ...):
        super().__init__(..., "2024-11-05", ...)
        self.server_config = McpServerConfig()  # ì—”ë“œí¬ì¸íŠ¸ ì„¤ì •
    
    async def _send_mcp_request(self, method: str, params: Optional[Dict[str, Any]] = None) -> Any:
        headers = {
            "Content-Type": "application/json",
            "Accept": "text/event-stream",  # SSEë§Œ í—ˆìš©
            "Cache-Control": "no-cache"
        }
        
        # POST ìš”ì²­ í›„ streamìœ¼ë¡œ ì‘ë‹µ ìˆ˜ì‹ 
        async with client.stream("POST", endpoint_url, headers=headers, json=message) as response:
            # SSE ìŠ¤íŠ¸ë¦¼ ì²˜ë¦¬
            async for line in response.aiter_lines():
                if line.startswith("data: "):
                    response_data = json.loads(line[6:])
                    if response_data.get("id") == request_id:
                        return response_data.get("result", response_data)
```

**SSE ì‘ë‹µ í˜•ì‹:**
```
event: message
data: {"jsonrpc": "2.0", "id": "request-id", "result": {...}}

event: ping
data: {}

data: [DONE]
```

**ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤:**
- SSE ì „ìš© MCP ì„œë²„ì™€ í†µì‹ 
- ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µì´ í•„ìš”í•œ ê²½ìš°
- ì»¤ìŠ¤í…€ ì—”ë“œí¬ì¸íŠ¸ê°€ í•„ìš”í•œ ê²½ìš°

---

#### 3.3.2 StreamableHttpClient (Streamable HTTP ë°©ì‹ - MCP í‘œì¤€)

**íŠ¹ì§•:**
- **Content-Typeì— ë”°ë¼ ìë™ ì²˜ë¦¬**: JSON ë˜ëŠ” SSE ìŠ¤íŠ¸ë¦¼ ëª¨ë‘ ì§€ì›
- **í”„ë¡œí† ì½œ ë²„ì „**: `2025-03-26` (ìµœì‹  MCP í‘œì¤€)
- **MCP í‘œì¤€ ì¤€ìˆ˜**: MCP ê³µì‹ ìŠ¤í™ì— ë”°ë¥¸ êµ¬í˜„
- **Accept í—¤ë”**: `application/json, text/event-stream` (ë‘˜ ë‹¤ í—ˆìš©)

**êµ¬í˜„:**

```python
class StreamableHttpClient(BaseMcpClient):
    def __init__(self, ...):
        super().__init__(..., "2025-03-26", ...)  # ìµœì‹  í”„ë¡œí† ì½œ ë²„ì „
    
    async def _send_mcp_request(self, method: str, params: Optional[Dict[str, Any]] = None) -> Any:
        headers = {
            "Content-Type": "application/json",
            "Accept": "application/json, text/event-stream"  # ë‘˜ ë‹¤ í—ˆìš©
        }
        
        # ì¼ë°˜ POST ìš”ì²­
        response = await client.post(self.url, headers=headers, json=message)
        
        if response.status_code == 200:
            content_type = response.headers.get("content-type", "").lower()
            
            if "application/json" in content_type:
                # ë‹¨ì¼ JSON ì‘ë‹µ ì²˜ë¦¬
                result = response.json()
                self._check_json_rpc_error(result)
                return result.get("result", {"content": []})
            
            elif "text/event-stream" in content_type:
                # SSE ìŠ¤íŠ¸ë¦¼ ì‘ë‹µ ì²˜ë¦¬
                return await self._handle_sse_response(response, request_id)
```

**ì‘ë‹µ ì²˜ë¦¬:**
- **JSON ì‘ë‹µ**: ì¦‰ì‹œ íŒŒì‹±í•˜ì—¬ ë°˜í™˜
- **SSE ìŠ¤íŠ¸ë¦¼**: `_handle_sse_response()`ë¡œ ì²˜ë¦¬

**ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤:**
- MCP í‘œì¤€ì„ ì¤€ìˆ˜í•˜ëŠ” ì„œë²„ì™€ í†µì‹ 
- ì„œë²„ê°€ JSON ë˜ëŠ” SSE ì¤‘ ì„ íƒì ìœ¼ë¡œ ì‘ë‹µí•˜ëŠ” ê²½ìš°
- ìµœì‹  MCP í”„ë¡œí† ì½œ ë²„ì „ì´ í•„ìš”í•œ ê²½ìš°

---

#### 3.3.3 ë¹„êµí‘œ

| í•­ëª© | HttpSseMcpClient | StreamableHttpClient |
|------|------------------|---------------------|
| **í”„ë¡œí† ì½œ ë²„ì „** | 2024-11-05 | 2025-03-26 |
| **ì‘ë‹µ ë°©ì‹** | í•­ìƒ SSE ìŠ¤íŠ¸ë¦¼ | JSON ë˜ëŠ” SSE (ìë™ ê°ì§€) |
| **ìš”ì²­ ë°©ì‹** | `client.stream()` | `client.post()` |
| **Accept í—¤ë”** | `text/event-stream` | `application/json, text/event-stream` |
| **ì—”ë“œí¬ì¸íŠ¸ ì„¤ì •** | `McpServerConfig` ì§€ì› | URL ì§ì ‘ ì‚¬ìš© |
| **MCP í‘œì¤€ ì¤€ìˆ˜** | ë¶€ë¶„ì  | ì™„ì „ ì¤€ìˆ˜ |
| **ì‚¬ìš© ëª©ì ** | SSE ì „ìš© ì„œë²„ | í‘œì¤€ MCP ì„œë²„ |

---

#### 3.3.4 í´ë¼ì´ì–¸íŠ¸ ì„ íƒ ë¡œì§

```python
def _build_client_from_server_info(
    self,
    server_id: int,
    name: str,
    url: str,
    connection_type: str,  # ì´ ê°’ì— ë”°ë¼ ì„ íƒ
    auth_type: str = None,
    auth_parameters: Dict = None,
):
    """
    ì„œë²„ ì •ë³´ë¡œë¶€í„° MCP í´ë¼ì´ì–¸íŠ¸ ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
    """
    if connection_type == ExternalServerConnectionType.STREAMABLE_HTTP:
        return StreamableHttpClient(server_id, name, url, auth_type, auth_parameters)
    else:
        # ê¸°ë³¸ê°’: HttpSseMcpClient
        return HttpSseMcpClient(server_id, name, url, auth_type, auth_parameters)
```

**ì„ íƒ ê¸°ì¤€:**
- `connection_type == "STREAMABLE_HTTP"` â†’ `StreamableHttpClient`
- ê·¸ ì™¸ (ê¸°ë³¸ê°’) â†’ `HttpSseMcpClient`

---

## 9. í†µì‹  í”„ë¡œí† ì½œ

### 9.1 JSON-RPC 2.0 ë©”ì‹œì§€ í˜•ì‹

**ìš”ì²­ ë©”ì‹œì§€:**
```json
{
  "jsonrpc": "2.0",
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "method": "tools/call",
  "params": {
    "name": "get_business_trip_regulations",
    "arguments": {
      "bizNo": "1234567"
    }
  }
}
```

**ì‘ë‹µ ë©”ì‹œì§€:**
```json
{
  "jsonrpc": "2.0",
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "result": {
    "content": [
      {
        "type": "text",
        "text": "ì¶œì¥ê·œì • ë‚´ìš©..."
      }
    ]
  }
}
```

**ì—ëŸ¬ ì‘ë‹µ:**
```json
{
  "jsonrpc": "2.0",
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "error": {
    "code": -32603,
    "message": "Internal error",
    "data": "ìƒì„¸ ì—ëŸ¬ ì •ë³´"
  }
}
```

### 9.2 MCP ë©”ì„œë“œ

**1. initialize**
```python
params = {
    "protocolVersion": "2024-11-05",
    "capabilities": {},
    "clientInfo": {
        "name": "ADP-Client-{server_name}",
        "version": "1.0.0"
    }
}
```

**2. tools/list**
```python
# ë„êµ¬ ëª©ë¡ ì¡°íšŒ
result = await client._send_mcp_request("tools/list")
# ì‘ë‹µ: {"tools": [{"name": "...", "description": "...", "inputSchema": {...}}]}
```

**3. tools/call**
```python
# ë„êµ¬ í˜¸ì¶œ
params = {
    "name": "tool_name",
    "arguments": {...}
}
result = await client._send_mcp_request("tools/call", params)
```

---

## 5. ë„êµ¬ íƒ€ì… ë° ì‹¤í–‰ íë¦„

### 5.1 MCP íƒ€ì… ë„êµ¬ ì‹¤í–‰

```python
async def _execute_mcp_tool(
    self, 
    tool_context: Dict[str, Any], 
    server_id: str, 
    arguments: Dict[str, Any]
) -> Dict[str, Any]:
    """
    ì™¸ë¶€ MCP ì„œë²„ ë„êµ¬ ì‹¤í–‰
    """
    internal_server_id = await self._get_internal_server_id()
    actual_tool_name = tool_context.get("actual_tool_name")
    
    if server_id == internal_server_id:
        # ë‚´ë¶€ MCP ì„œë²„ í˜¸ì¶œ
        from common.core.mcp.mcp import mcp
        result = await mcp.call_tool(actual_tool_name, arguments)
        return {"result": str(result)}
    else:
        # ì™¸ë¶€ MCP ì„œë²„ í˜¸ì¶œ
        client = await self._create_client(tool_context)
        return await client.call_tool(actual_tool_name, arguments)
```

**ì‹¤í–‰ íë¦„:**
```
1. ë„êµ¬ ì»¨í…ìŠ¤íŠ¸ì—ì„œ ì„œë²„ ID í™•ì¸
   â†“
2. ë‚´ë¶€ ì„œë²„ì¸ì§€ ì™¸ë¶€ ì„œë²„ì¸ì§€ íŒë‹¨
   â†“
3. ë‚´ë¶€: mcp.call_tool() ì§ì ‘ í˜¸ì¶œ
   ì™¸ë¶€: í´ë¼ì´ì–¸íŠ¸ ìƒì„± í›„ call_tool() í˜¸ì¶œ
   â†“
4. ê²°ê³¼ ë°˜í™˜
```

### 5.2 SERVICE íƒ€ì… ë„êµ¬ ì‹¤í–‰

```python
async def _execute_service_tool(
    self, 
    tool_context: Dict[str, Any], 
    arguments: Dict[str, Any]
) -> Dict[str, Any]:
    """
    ë‚´ë¶€ ì„œë¹„ìŠ¤ë¥¼ ë„êµ¬ë¡œ ì‹¤í–‰
    """
    service_id = tool_context["tool_reference_id"]
    
    query = arguments.get("query", "")
    if not query:
        query = str(arguments)
    
    execution_input = ExecutionInput(query=query)
    result = await workflow_engine.execute_service(
        service_id=service_id,
        execution_input=execution_input,
        input_data=arguments
    )
    return {"result": str(result)}
```

**íŠ¹ì§•:**
- ì›Œí¬í”Œë¡œìš° ì„œë¹„ìŠ¤ë¥¼ ë„êµ¬ë¡œ ë…¸ì¶œ
- `query` íŒŒë¼ë¯¸í„°ë¡œ ì„œë¹„ìŠ¤ ì‹¤í–‰
- ì „ì²´ ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ ê²°ê³¼ ë°˜í™˜

### 5.3 AGENT íƒ€ì… ë„êµ¬ ì‹¤í–‰

```python
async def _execute_agent_tool(
    self, 
    tool_context: Dict[str, Any], 
    arguments: Dict[str, Any], 
    agent_instance_id: int
) -> Dict[str, Any]:
    """
    ë‚´ë¶€ ì—ì´ì „íŠ¸ë¥¼ ë„êµ¬ë¡œ ì‹¤í–‰
    """
    agent_registry = get_agent_registry()
    agent_sub_type = tool_context["agent_sub_type"]
    agent = agent_registry.get_agent(agent_sub_type)
    
    preset_parameters = tool_context.get("preset_parameters", {})
    agent_common_parameters = preset_parameters.get("common_parameters", {})
    agent_custom_parameters = preset_parameters.get("custom_parameters", {})
    
    agent_instance_info = {
        "agent_instance_id": agent_instance_id,
        "agent_id": tool_context["agent_id"],
        "agent_type": tool_context["agent_type"],
        "agent_sub_type": agent_sub_type,
        "common_parameters": agent_common_parameters,
        "custom_parameters": agent_custom_parameters,
    }
    
    result = await agent.invoke(
        agent_instance_info=agent_instance_info,
        user_input=arguments,
        prev_results=None
    )
    return {"result": str(result)}
```

**íŠ¹ì§•:**
- ë‚´ë¶€ ì—ì´ì „íŠ¸ë¥¼ ë„êµ¬ë¡œ ë…¸ì¶œ
- `AgentRegistry`ì—ì„œ ì—ì´ì „íŠ¸ ì¡°íšŒ
- ì‚¬ì „ ì„¤ì • íŒŒë¼ë¯¸í„° ì§€ì›

---

## 10. í´ë¼ì´ì–¸íŠ¸ êµ¬í˜„

### 6.1 í´ë¼ì´ì–¸íŠ¸ ìƒì„± ë¡œì§

```python
def _build_client_from_server_info(
    self,
    server_id: int,
    name: str,
    url: str,
    connection_type: str,
    auth_type: str = None,
    auth_parameters: Dict = None,
):
    """
    ì„œë²„ ì •ë³´ë¡œë¶€í„° MCP í´ë¼ì´ì–¸íŠ¸ ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
    """
    if connection_type == ExternalServerConnectionType.STREAMABLE_HTTP:
        return StreamableHttpClient(server_id, name, url, auth_type, auth_parameters)
    else:
        return HttpSseMcpClient(server_id, name, url, auth_type, auth_parameters)
```

**ì—°ê²° íƒ€ì…ë³„ í´ë¼ì´ì–¸íŠ¸:**
- `STREAMABLE_HTTP`: `StreamableHttpClient` ì‚¬ìš©
- ê¸°íƒ€ (ê¸°ë³¸ê°’): `HttpSseMcpClient` ì‚¬ìš©

### 6.2 í´ë¼ì´ì–¸íŠ¸ ìºì‹± ì „ëµ

```python
async def _create_client(self, tool_context: Dict[str, Any]):
    """
    tool_contextë¡œë¶€í„° í´ë¼ì´ì–¸íŠ¸ ìƒì„± ë° ìºì‹±
    """
    server_id = tool_context["server_id"]
    
    async with self._cache_lock:  # ë™ì‹œì„± ì œì–´
        if server_id in self._client_cache:
            return self._client_cache[server_id]  # ìºì‹œ íˆíŠ¸
        
        # ìºì‹œ ë¯¸ìŠ¤: ìƒˆ í´ë¼ì´ì–¸íŠ¸ ìƒì„±
        client = self._build_client_from_server_info(...)
        self._client_cache[server_id] = client
        return client
```

**ìºì‹± ì¥ì :**
- ì—°ê²° ì¬ì‚¬ìš©ìœ¼ë¡œ ì„±ëŠ¥ í–¥ìƒ
- ì„œë²„ë‹¹ í•˜ë‚˜ì˜ í´ë¼ì´ì–¸íŠ¸ ì¸ìŠ¤í„´ìŠ¤ ìœ ì§€
- ë™ì‹œì„± ì•ˆì „ì„± ë³´ì¥ (`asyncio.Lock()`)

### 6.3 í´ë¼ì´ì–¸íŠ¸ ì—…ë°ì´íŠ¸

```python
async def update_client(self, server_id: int) -> None:
    """
    ì„œë²„ ì •ë³´ ë³€ê²½ ì‹œ í´ë¼ì´ì–¸íŠ¸ ìºì‹œ ì—…ë°ì´íŠ¸
    """
    mcp_server = await mcp_repository.get_mcp_server(server_id)
    if not mcp_server:
        return
    
    new_client = self._build_client_from_server_info(
        server_id=mcp_server.id,
        name=mcp_server.name,
        url=mcp_server.url,
        connection_type=mcp_server.connection_type,
        auth_type=mcp_server.auth_type,
        auth_parameters=mcp_server.auth_parameter_schema,
    )
    
    async with self._cache_lock:
        self._client_cache[server_id] = new_client
```

---

## 11. ë‚´ë¶€ MCP ì„œë²„

### 11.1 FastMCP ê¸°ë°˜ êµ¬í˜„

```python
# be_src/common/core/mcp/mcp.py
from mcp.server.fastmcp import FastMCP

# MCP ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
mcp = FastMCP("Test MCP Server")
```

### 11.2 ë„êµ¬ ë“±ë¡ ì˜ˆì‹œ

```python
@mcp.tool(
    "get_business_trip_regulations",
    "íšŒì‚¬ë³„ ì¶œì¥ê·œì • ë¬¸ì„œ(ë¹„ê³ )ë¥¼ ì¡°íšŒí•˜ëŠ” Tool",
)
async def get_business_trip_regulations(bizNo: str):
    """
    ì‚¬ì—…ìë²ˆí˜¸ë¡œ íšŒì‚¬ë³„ ì¶œì¥ê·œì • ë¬¸ì„œë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤.
    
    Args:
        bizNo: ì‚¬ì—…ìë²ˆí˜¸ (7ìë¦¬)
    """
    logger.info(f"get_business_trip_regulations: bizNo={bizNo}")
    
    try:
        # API ìš”ì²­ ë°ì´í„° êµ¬ì„±
        request_data = {
            "apiGubun": "C",
            "bizNo": bizNo
        }
        
        # API í˜¸ì¶œ
        async with httpx.AsyncClient(timeout=30.0) as client:
            response = await client.post(
                common_settings.BTMS_API_ENDPOINT + "/api/ax/common/info/getBizwManual",
                json=request_data,
                headers={"Content-Type": "application/json"}
            )
            
            if response.status_code == 200:
                result = response.json()
                # ì‘ë‹µ ì²˜ë¦¬...
                return json.dumps({
                    "status": "success",
                    "regulations": etcRmk,
                    "bizNo": bizNo
                }, ensure_ascii=False)
    except Exception as e:
        logger.error(f"ì˜ˆìƒì¹˜ ëª»í•œ ì˜¤ë¥˜: {e}")
        return json.dumps({
            "status": "error",
            "error": f"ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {str(e)}",
            "bizNo": bizNo
        }, ensure_ascii=False)
```

**ë„êµ¬ ë“±ë¡ íŠ¹ì§•:**
- `@mcp.tool()` ë°ì½”ë ˆì´í„°ë¡œ ë„êµ¬ ë“±ë¡
- í•¨ìˆ˜ ì‹œê·¸ë‹ˆì²˜ê°€ ìë™ìœ¼ë¡œ input schemaë¡œ ë³€í™˜
- docstringì´ ë„êµ¬ ì„¤ëª…ìœ¼ë¡œ ì‚¬ìš©ë¨

### 11.3 ë‚´ë¶€ ì„œë²„ í˜¸ì¶œ

```python
# McpClientManagerì—ì„œ ë‚´ë¶€ ì„œë²„ í˜¸ì¶œ
if server_id == internal_server_id:
    from common.core.mcp.mcp import mcp
    result = await mcp.call_tool(actual_tool_name, arguments)
    return {"result": str(result)}
```

---

## 12. ì‹¤ì œ ì½”ë“œ ì˜ˆì‹œ

### 12.1 Orchestrator Agentì—ì„œì˜ ì‚¬ìš©

```python
# be_src/common/agent/orchestrator/orchestrator_agent_mcp_executor.py

class OrchestratorAgentMcpExecutor(OrchestratorAgent):
    async def execute(self, input: OrchestratorAgentMcpExecutorIn):
        # 1. ë„êµ¬ ëª©ë¡ ì¡°íšŒ
        from common.mcp.mcp_client_manager import mcp_client_manager
        agent_instance_id = input.agent_instance_id
        
        tools_from_manager = await mcp_client_manager.get_available_tools(agent_instance_id)
        
        # 2. LLMìš© ë„êµ¬ ì„¤ëª… ìƒì„±
        tool_descriptions_list = []
        for tool_info in tools_from_manager:
            tool_desc = f"  - {tool_info['tool_name']}: {tool_info['description']}\n    ë§¤ê°œë³€ìˆ˜: {tool_info['parameters_info']}"
            tool_descriptions_list.append(tool_desc)
        
        tool_descriptions = "\n".join(tool_descriptions_list)
        
        # 3. LLMì—ê²Œ ì‘ì—… ê³„íš ìˆ˜ë¦½ ìš”ì²­
        initial_task_plan_llm_result = await self._call_task_plan_creator_llm(
            query,
            task_plan_message_id,
            tool_descriptions,
            previous_task_results=task_results,
        )
        
        # 4. ì‘ì—… ê³„íš íŒŒì‹±
        task_plan_list = await self._parse_task_plan_from_llm_response(
            initial_task_plan_llm_result.llm_response
        )
        
        # 5. ê° ì‘ì—… ë‹¨ê³„ë³„ ì‹¤í–‰
        for task in task_plan_list:
            tool_name = task["tool_name"]
            parameters = task["parameters"]
            
            # ì´ì „ ì‘ì—… ê²°ê³¼ ì°¸ì¡° ì²˜ë¦¬
            processed_parameters = {}
            for key, value in parameters.items():
                if isinstance(value, str) and value.startswith("result_of_task_"):
                    processed_parameters[key] = prev_task_result
                else:
                    processed_parameters[key] = value
            
            # ë„êµ¬ í˜¸ì¶œ
            result = await mcp_client_manager.call_tool(
                tool_name, 
                processed_parameters, 
                agent_instance_id
            )
            
            task_results.append({**task, "task_result": str(result)})
            prev_task_result = str(result)
        
        # 6. ìµœì¢… ìš”ì•½ ìƒì„±
        result = await self._call_task_plan_summary_llm(
            query, 
            tool_descriptions, 
            result_by_step=task_results
        )
        return OrchestratorAgentMcpExecutorOut.model_validate(result.model_dump())
```

### 12.2 Executor Agentì—ì„œì˜ ì‚¬ìš©

```python
# ì›Œí¬í”Œë¡œìš° ë…¸ë“œì—ì„œ ExecutorAgentMcpTool í˜¸ì¶œ
# ì´ì „ ë…¸ë“œì˜ ê²°ê³¼ê°€ prev_resultë¡œ ì „ë‹¬ë¨

class ExecutorAgentMcpTool(ExecutorAgent):
    async def execute(self, input: ExecutorAgentMcpToolIn):
        # ë„êµ¬ ì •ë³´ ì¶”ì¶œ
        tool_name = input.custom_parameters.parameters.get("name")
        tool_input_parameters = input.custom_parameters.parameters.get("input_parameters")
        
        # ì´ì „ ê²°ê³¼ ë³‘í•©
        prev_result_value = input.custom_parameters.prev_result or {}
        formatted_params = auto_extract_and_format_instruction(
            str(tool_input_parameters), 
            prev_result_value
        )
        
        # MCP ë„êµ¬ í˜¸ì¶œ
        result = await mcp_client_manager.call_tool(
            tool_name,
            json.loads(formatted_params.replace("'", '"')),
            input.agent_instance_id,
        )
        
        return ExecutorAgentMcpToolOut(result=str(result))
```

### 12.3 ë„êµ¬ í˜¸ì¶œ ìƒì„¸ ì˜ˆì‹œ

```python
# 1. LLMì´ ë„êµ¬ í˜¸ì¶œ ìš”ì²­
tool_name = "123://get_business_trip_regulations"
arguments = {"bizNo": "1234567"}

# 2. McpClientManager.call_tool() í˜¸ì¶œ
result = await mcp_client_manager.call_tool(
    tool_name=tool_name,
    args=arguments,
    agent_instance_id=agent_instance_id
)

# ë‚´ë¶€ ì²˜ë¦¬ íë¦„:
# - tool_name íŒŒì‹±: "123://get_business_trip_regulations" 
#   â†’ server_id="123", tool_name="get_business_trip_regulations"
# - ë„êµ¬ ì»¨í…ìŠ¤íŠ¸ ì¡°íšŒ: DBì—ì„œ tool_setting ì¡°íšŒ
# - ë„êµ¬ íƒ€ì… í™•ì¸: ToolType.MCP
# - _execute_mcp_tool() í˜¸ì¶œ
#   - ë‚´ë¶€ ì„œë²„ì¸ì§€ í™•ì¸
#   - ì™¸ë¶€ ì„œë²„ì´ë¯€ë¡œ í´ë¼ì´ì–¸íŠ¸ ìƒì„±/ì¡°íšŒ
#   - client.call_tool() í˜¸ì¶œ
#     - HTTP+SSE ìš”ì²­ ì „ì†¡
#     - SSE ìŠ¤íŠ¸ë¦¼ ì‘ë‹µ ìˆ˜ì‹ 
#     - ê²°ê³¼ ë°˜í™˜

# 3. ê²°ê³¼ ë°˜í™˜
# {"result": "{\"status\": \"success\", \"regulations\": \"...\"}"}
```

---

## 13. í•µì‹¬ ì„¤ê³„ ì›ì¹™

### 9.1 í‘œì¤€ í”„ë¡œí† ì½œ ì¤€ìˆ˜

- **JSON-RPC 2.0**: ëª¨ë“  í†µì‹ ì´ í‘œì¤€ í”„ë¡œí† ì½œ ì¤€ìˆ˜
- **MCP ìŠ¤í™**: MCP ê³µì‹ ìŠ¤í™ ì¤€ìˆ˜
- **í˜¸í™˜ì„±**: ë‹¤ë¥¸ MCP í´ë¼ì´ì–¸íŠ¸/ì„œë²„ì™€ í˜¸í™˜ ê°€ëŠ¥

### 9.2 í™•ì¥ ê°€ëŠ¥í•œ ì•„í‚¤í…ì²˜

- **ì¶”ìƒ í´ë˜ìŠ¤**: `BaseMcpClient`ë¡œ ë‹¤ì–‘í•œ í†µì‹  ë°©ì‹ ì§€ì›
- **í”ŒëŸ¬ê·¸ì¸ ë°©ì‹**: ìƒˆë¡œìš´ í´ë¼ì´ì–¸íŠ¸ íƒ€ì… ì¶”ê°€ ìš©ì´
- **íƒ€ì…ë³„ ë¼ìš°íŒ…**: MCP/SERVICE/AGENT íƒ€ì…ë³„ ì²˜ë¦¬

### 9.3 ì„±ëŠ¥ ìµœì í™”

- **í´ë¼ì´ì–¸íŠ¸ ìºì‹±**: ì„œë²„ë‹¹ í•˜ë‚˜ì˜ í´ë¼ì´ì–¸íŠ¸ ì¸ìŠ¤í„´ìŠ¤ ìœ ì§€
- **ì—°ê²° ì¬ì‚¬ìš©**: HTTP ì—°ê²° í’€ë§ í™œìš©
- **ë™ì‹œì„± ì œì–´**: `asyncio.Lock()`ìœ¼ë¡œ ì•ˆì „í•œ ìºì‹œ ì ‘ê·¼

### 9.4 ì—ëŸ¬ ì²˜ë¦¬

```python
def _check_json_rpc_error(self, result: Dict[str, Any]) -> None:
    """
    JSON-RPC ì˜¤ë¥˜ í™•ì¸ ë° ì˜ˆì™¸ ë°œìƒ
    """
    if "error" in result and result["error"] is not None:
        error = result["error"]
        raise Exception(f"MCP JSON-RPC ì˜¤ë¥˜: {error.get('code')} - {error.get('message')}")
```

---

## 14. ìš”ì•½

### MCPì˜ ì—­í• 
- âœ… LLMê³¼ ì™¸ë¶€ ë„êµ¬ ê°„ì˜ í‘œì¤€í™”ëœ í†µì‹  í”„ë¡œí† ì½œ
- âœ… Tool Discovery, Resource Access, Prompt Templates ì§€ì›
- âœ… JSON-RPC 2.0 ê¸°ë°˜ í†µì‹ 

### í”„ë¡œì íŠ¸ êµ¬í˜„
- âœ… **McpClientManager**: ì¤‘ì•™ ê´€ë¦¬ ë° ë¼ìš°íŒ…
- âœ… **BaseMcpClient**: ì¶”ìƒ í´ë˜ìŠ¤ë¡œ í™•ì¥ì„± ì œê³µ
- âœ… **HttpSseMcpClient**: HTTP+SSE ë°©ì‹ í´ë¼ì´ì–¸íŠ¸
- âœ… **StreamableHttpClient**: Streamable HTTP ë°©ì‹ í´ë¼ì´ì–¸íŠ¸
- âœ… **ë‚´ë¶€ MCP ì„œë²„**: FastMCP ê¸°ë°˜ ë„êµ¬ ì œê³µ

### ë„êµ¬ íƒ€ì…
- âœ… **MCP**: ì™¸ë¶€ MCP ì„œë²„ ë„êµ¬
- âœ… **SERVICE**: ë‚´ë¶€ ì›Œí¬í”Œë¡œìš° ì„œë¹„ìŠ¤
- âœ… **AGENT**: ë‚´ë¶€ ì—ì´ì „íŠ¸

### í•µì‹¬ íŠ¹ì§•
- âœ… í‘œì¤€ í”„ë¡œí† ì½œ ì¤€ìˆ˜
- âœ… í™•ì¥ ê°€ëŠ¥í•œ ì•„í‚¤í…ì²˜
- âœ… í´ë¼ì´ì–¸íŠ¸ ìºì‹±ìœ¼ë¡œ ì„±ëŠ¥ ìµœì í™”
- âœ… íƒ€ì…ë³„ ë¼ìš°íŒ… ë° ì‹¤í–‰

